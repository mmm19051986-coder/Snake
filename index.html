<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ó–º–µ–π–∫–∞ –∑–Ω–∞–Ω–∏–π</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#eef2f5;
}

#game-wrapper {
  width: 720px;
  margin: 20px auto;
  background:#fff;
  padding:12px;
  border-radius:12px;
  position: relative;
}

h2 {
  text-align:center;
  margin:6px 0;
}

#editor {
  border:1px solid #ddd;
  padding:10px;
  margin-bottom:10px;
}

label {
  font-weight:bold;
  display:block;
  margin-top:6px;
}

textarea, input {
  width:100%;
  margin-top:4px;
}

button {
  margin-top:8px;
  padding:6px 14px;
  cursor:pointer;
}

canvas {
  display:block;
  margin:auto;
  border:2px solid #ddd;
  background:#ffffff;
}

#progress {
  height:10px;
  background:#ddd;
  margin-top:8px;
  border-radius:5px;
  overflow:hidden;
}

#progress-bar {
  height:100%;
  width:0%;
  background:#4caf50;
}

/* ===== –≠–ö–†–ê–ù –ü–û–ë–ï–î–´ ===== */

#winScreen {
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}

#fireworks {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:0;
}

#winContent {
  position:relative;
  z-index:2;
  background:#ffffff;
  color:#333;
  padding:24px 32px;
  border-radius:14px;
  text-align:center;
  min-width:300px;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

#winText {
  font-size:26px;
  margin-bottom:16px;
}

#restartBtn {
  padding:8px 18px;
  font-size:16px;
}
</style>
</head>

<body>

<div id="game-wrapper">
  <h2 id="taskTitle">–°–æ–±–µ—Ä–∏ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ</h2>

  <!-- –†–ï–î–ê–ö–¢–û–† -->
  <div id="editor">
    <label>–í–æ–ø—Ä–æ—Å / –∑–∞–¥–∞–Ω–∏–µ</label>
    <input id="taskInput" value="–°–æ–±–µ—Ä–∏ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ">

    <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞</label>
    <textarea id="correctInput">—Å—Ç–æ–ª, –¥–æ–º, –æ–∫–Ω–æ, –∫–Ω–∏–≥–∞</textarea>

    <label>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞</label>
    <textarea id="wrongInput">–±–µ–∂–∞—Ç—å, –∫—Ä–∞—Å–∏–≤—ã–π, –≤–∞–∂–Ω—ã–π</textarea>

    <label>–¢–µ–∫—Å—Ç –ø—Ä–∏ –ø–æ–±–µ–¥–µ</label>
    <input id="winInput" value="üéâ –ú–æ–ª–æ–¥–µ—Ü! –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!">

    <button id="startBtn">‚ñ∂ –ò–≥—Ä–∞—Ç—å</button>
  </div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>

  <div id="progress">
    <div id="progress-bar"></div>
  </div>

  <!-- –≠–ö–†–ê–ù –ü–û–ë–ï–î–´ -->
  <div id="winScreen">
    <canvas id="fireworks"></canvas>
    <div id="winContent">
      <div id="winText"></div>
      <button id="restartBtn">üîÑ –°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
    </div>
  </div>
</div>

<script>
/* =====================
   DOM
===================== */

const taskInput = document.getElementById("taskInput");
const correctInput = document.getElementById("correctInput");
const wrongInput = document.getElementById("wrongInput");
const winInput = document.getElementById("winInput");
const taskTitle = document.getElementById("taskTitle");
const progressBar = document.getElementById("progress-bar");
const winScreen = document.getElementById("winScreen");
const winText = document.getElementById("winText");
const restartBtn = document.getElementById("restartBtn");

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const fw = document.getElementById("fireworks");
const fctx = fw.getContext("2d");
fw.width = 720;
fw.height = 500;

/* =====================
   –ù–ê–°–¢–†–û–ô–ö–ò
===================== */

const SPEED = 0.9;
const TOTAL_ITEMS = 6;

/* =====================
   –ü–ï–†–ï–ú–ï–ù–ù–´–ï
===================== */

let snake = [{x:300,y:200}];
let dir = {x:1,y:0};
let items = [];
let correctCount = 0;
let REQUIRED = 0;
let gameRunning = false;
let config = null;
let particles = [];

/* =====================
   –£–ü–†–ê–í–õ–ï–ù–ò–ï
===================== */

canvas.addEventListener("click", e => {
  if (!gameRunning) return;
  const r = canvas.getBoundingClientRect();
  const h = snake[0];
  const dx = e.clientX - r.left - h.x;
  const dy = e.clientY - r.top - h.y;
  const d = Math.hypot(dx,dy) || 1;
  dir = {x:dx/d, y:dy/d};
});

/* =====================
   –°–¢–ê–†–¢
===================== */

document.getElementById("startBtn").onclick = () => {
  config = {
    task: taskInput.value,
    correct: correctInput.value.split(",").map(s=>s.trim()).filter(Boolean),
    wrong: wrongInput.value.split(",").map(s=>s.trim()).filter(Boolean),
    winText: winInput.value
  };

  if (config.correct.length === 0) {
    alert("–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞");
    return;
  }

  REQUIRED = config.correct.length;
  taskTitle.innerText = config.task;

  resetGame();
  hideWin();
  gameRunning = true;
};

/* =====================
   –ò–ì–†–ê
===================== */

function spawnItem(forceCorrect=false) {
  const pool = forceCorrect
    ? config.correct.map(t=>({text:t, correct:true}))
    : [...config.correct.map(t=>({text:t, correct:true})),
       ...config.wrong.map(t=>({text:t, correct:false}))];

  const it = pool[Math.floor(Math.random()*pool.length)];
  items.push({
    ...it,
    x:Math.random()*560+20,
    y:Math.random()*360+20
  });
}

function ensureItems() {
  while (items.length < TOTAL_ITEMS) spawnItem();
}

function moveSnake() {
  const h = snake[0];
  const nh = {x:h.x + dir.x*SPEED, y:h.y + dir.y*SPEED};

  if (nh.x<0||nh.x>600||nh.y<0||nh.y>400) {
    gameRunning=false;
    return;
  }

  snake.unshift(nh);
  while (snake.length > 40) snake.pop();
}

function checkCollision() {
  const h = snake[0];
  items.forEach((it,i)=>{
    if (Math.hypot(h.x-it.x, h.y-it.y) < 14) {
      if (!it.correct) {
        gameRunning=false;
        return;
      }
      correctCount++;
      items.splice(i,1);
      updateProgress();
      if (correctCount >= REQUIRED) {
        gameRunning=false;
        showWin();
      }
    }
  });
}

function updateProgress() {
  progressBar.style.width = (correctCount/REQUIRED*100) + "%";
}

/* =====================
   –û–¢–†–ò–°–û–í–ö–ê
===================== */

function draw() {
  ctx.clearRect(0,0,600,400);

  items.forEach(it=>{
    ctx.fillStyle="#90caf9";
    ctx.beginPath();
    ctx.arc(it.x,it.y,10,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="#000";
    ctx.fillText(it.text,it.x-14,it.y-14);
  });

  ctx.strokeStyle="#4caf50";
  ctx.lineWidth=6;
  ctx.beginPath();
  snake.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
  ctx.stroke();
}

/* =====================
   –§–ï–ô–ï–†–í–ï–†–ö
===================== */

function launchFireworks() {
  for (let i=0;i<40;i++) {
    particles.push({
      x:fw.width/2,
      y:fw.height/2,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:60,
      color:`hsl(${Math.random()*360},80%,60%)`
    });
  }
}

function drawFireworks() {
  fctx.clearRect(0,0,fw.width,fw.height);
  particles.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    fctx.fillStyle=p.color;
    fctx.fillRect(p.x,p.y,3,3);
  });
  particles = particles.filter(p=>p.life>0);
  if (particles.length) requestAnimationFrame(drawFireworks);
}

/* =====================
   –ü–û–ë–ï–î–ê
===================== */

function showWin() {
  winText.innerText = config.winText;
  winScreen.style.display="flex";
  launchFireworks();
  drawFireworks();
}

function hideWin() {
  winScreen.style.display="none";
  particles=[];
}

restartBtn.onclick = hideWin;

/* =====================
   –°–ë–†–û–°
===================== */

function resetGame() {
  snake=[{x:300,y:200}];
  dir={x:1,y:0};
  items=[];
  correctCount=0;
  progressBar.style.width="0%";
  ensureItems();
}

/* =====================
   –¶–ò–ö–õ
===================== */

function loop() {
  if (gameRunning) {
    moveSnake();
    checkCollision();
    ensureItems();
  }
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
