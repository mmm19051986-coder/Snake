<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Змейка знаний</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#e3f2fd;
}

#game-wrapper {
  width: 720px;
  margin: 20px auto;
  background:#ffffff;
  padding:12px;
  border-radius:14px;
}

h2 { text-align:center; margin:6px 0; }

#editor {
  border:1px solid #cfd8dc;
  padding:10px;
  margin-bottom:10px;
  background:#f9fbfd;
}

label { font-weight:bold; display:block; margin-top:6px; }

textarea, input {
  width:100%;
  margin-top:4px;
}

button {
  margin-top:8px;
  padding:6px 14px;
  cursor:pointer;
}

canvas {
  display:block;
  margin:auto;
  border-radius:10px;
  background:#f1f8ff;
}

#progress {
  height:10px;
  background:#cfd8dc;
  margin-top:8px;
  border-radius:5px;
}
#progress-bar {
  height:100%;
  width:0%;
  background:#66bb6a;
}

#feedback {
  text-align:center;
  font-weight:bold;
  min-height:22px;
}
.success { color:#2e7d32; }
.error { color:#ef6c00; }
</style>
</head>

<body>

<div id="game-wrapper">
  <h2 id="taskTitle">Собери только глаголы</h2>

  <div id="editor">
    <label>Вопрос / задание</label>
    <input id="taskInput" value="Собери только глаголы">

    <label>Правильные слова</label>
    <textarea id="correctInput">бегать, прыгать, играть</textarea>

    <label>Неправильные слова</label>
    <textarea id="wrongInput">молоко, красивый, важный</textarea>

    <button id="startBtn">▶ Играть</button>
  </div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>

  <div id="progress"><div id="progress-bar"></div></div>
  <div id="feedback"></div>
</div>

<script>
/* ===== DOM ===== */
const taskTitle   = document.getElementById("taskTitle");
const taskInput   = document.getElementById("taskInput");
const correctInput= document.getElementById("correctInput");
const wrongInput  = document.getElementById("wrongInput");
const startBtn    = document.getElementById("startBtn");
const progressBar = document.getElementById("progress-bar");
const feedback    = document.getElementById("feedback");
const canvas      = document.getElementById("gameCanvas");
const ctx         = canvas.getContext("2d");

/* ===== НАСТРОЙКИ ===== */
const SPEED = 1;
const TURN = 0.08;
const REQUIRED = 5;

/* ===== СОСТОЯНИЕ ===== */
let snake = [];
let angle = 0;
let targetAngle = 0;
let items = [];
let correctCount = 0;
let running = false;
let CONFIG = null;

/* ===== КЛИК = НАПРАВЛЕНИЕ ===== */
canvas.addEventListener("click", e => {
  if (!running) return;
  const r = canvas.getBoundingClientRect();
  const x = e.clientX - r.left;
  const y = e.clientY - r.top;
  const h = snake[0];
  targetAngle = Math.atan2(y - h.y, x - h.x);
});

/* ===== СТАРТ ===== */
startBtn.onclick = () => {
  CONFIG = {
    task: taskInput.value,
    correct: correctInput.value.split(",").map(s=>s.trim()).filter(Boolean),
    wrong: wrongInput.value.split(",").map(s=>s.trim()).filter(Boolean)
  };

  taskTitle.innerText = CONFIG.task;
  resetGame();
  running = true;
};

/* ===== ЭЛЕМЕНТЫ ===== */
function spawnItem(forceCorrect=false) {
  const pool = forceCorrect
    ? CONFIG.correct.map(t=>({text:t, correct:true}))
    : [
        ...CONFIG.correct.map(t=>({text:t, correct:true})),
        ...CONFIG.wrong.map(t=>({text:t, correct:false}))
      ];

  const it = pool[Math.floor(Math.random()*pool.length)];
  items.push({
    ...it,
    x:Math.random()*540+30,
    y:Math.random()*340+30
  });
}

function ensureItems() {
  if (!items.some(i=>i.correct)) spawnItem(true);
  while (items.length < 4) spawnItem();
}

/* ===== ДВИЖЕНИЕ ===== */
function moveSnake() {
  angle += (targetAngle - angle) * TURN;
  const h = snake[0];
  const nh = {
    x: h.x + Math.cos(angle) * SPEED,
    y: h.y + Math.sin(angle) * SPEED
  };
  snake.unshift(nh);
  while (snake.length > 40 + correctCount * 8) snake.pop();
}

/* ===== СБОР ===== */
function checkItems() {
  const h = snake[0];
  items.forEach((it,i)=>{
    const dx=h.x-it.x;
    const dy=h.y-it.y;
    if (Math.sqrt(dx*dx+dy*dy) < 14) {
      if (it.correct) {
        correctCount++;
        feedback.innerText="Верно!";
        feedback.className="success";
      } else {
        feedback.innerText="Подумай ещё";
        feedback.className="error";
      }
      setTimeout(()=>feedback.innerText="",500);
      items.splice(i,1);
    }
  });
}

/* ===== ПРОГРЕСС ===== */
function updateProgress() {
  progressBar.style.width =
    Math.min(correctCount/REQUIRED*100,100)+"%";
}

/* ===== ОТРИСОВКА ===== */
function draw() {
  ctx.clearRect(0,0,600,400);

  items.forEach(it=>{
    ctx.fillStyle=it.correct?"#81c784":"#b0bec5";
    ctx.beginPath();
    ctx.arc(it.x,it.y,10,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="#000";
    ctx.fillText(it.text,it.x-12,it.y-14);
  });

  ctx.strokeStyle="#66bb6a";
  ctx.lineWidth=8;
  ctx.beginPath();
  snake.forEach((p,i)=>{
    if(i===0) ctx.moveTo(p.x,p.y);
    else ctx.lineTo(p.x,p.y);
  });
  ctx.stroke();

  const h=snake[0];
  ctx.fillStyle="#388e3c";
  ctx.beginPath();
  ctx.arc(h.x,h.y,7,0,Math.PI*2);
  ctx.fill();
}

/* ===== ЦИКЛ ===== */
function loop() {
  if (running) {
    moveSnake();
    checkItems();
    ensureItems();
    updateProgress();
  }
  draw();
  requestAnimationFrame(loop);
}

/* ===== СБРОС ===== */
function resetGame() {
  snake=[{x:300,y:200}];
  angle=0; targetAngle=0;
  items=[];
  correctCount=0;
  progressBar.style.width="0%";
  ensureItems();
}

loop();
</script>

</body>
</html>
