<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ó–º–µ–π–∫–∞ –∑–Ω–∞–Ω–∏–π</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
  }

  #game-wrapper {
    width: 640px;
    margin: 20px auto;
    background: #ffffff;
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  #task {
    text-align: center;
    font-size: 20px;
    margin-bottom: 8px;
  }

  canvas {
    display: block;
    margin: auto;
    border: 2px solid #ddd;
    background: #fff;
  }

  #progress {
    height: 10px;
    background: #ddd;
    border-radius: 5px;
    margin-top: 8px;
    overflow: hidden;
  }

  #progress-bar {
    height: 100%;
    width: 0%;
    background: #4caf50;
    transition: width 0.3s;
  }

  #feedback {
    text-align: center;
    margin-top: 8px;
    font-weight: bold;
    min-height: 22px;
  }

  .success { color: #2e7d32; }
  .error { color: #ef6c00; }
</style>
</head>

<body>

<div id="game-wrapper">
  <div id="task"></div>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="progress"><div id="progress-bar"></div></div>
  <div id="feedback"></div>
</div>

<script>
/* =====================
   –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
===================== */

const GAME_CONFIG = {
  taskText: "–°–æ–±–µ—Ä–∏ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ",

  correctItems: ["—Å—Ç–æ–ª", "–¥–æ–º", "–æ–∫–Ω–æ", "–∫–Ω–∏–≥–∞"],
  wrongItems: ["–±–µ–∂–∞—Ç—å", "–∫—Ä–∞—Å–∏–≤—ã–π", "–¥—É–º–∞—Ç—å"],

  gameplay: {
    speed: 160,
    snakeGrowth: true,
    elementsOnField: 7,
    noPenaltyMode: true
  },

  progress: {
    requiredCorrect: 6
  },

  ui: {
    noTextMode: false
  },

  feedback: {
    successText: ["–í–µ—Ä–Ω–æ!", "–û—Ç–ª–∏—á–Ω–æ!", "–ú–æ–ª–æ–¥–µ—Ü!"],
    errorText: ["–ü–æ–¥—É–º–∞–π –µ—â—ë", "–ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞"]
  }
};

/* =====================
   –ü–ï–†–ï–ú–ï–ù–ù–´–ï
===================== */

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
document.getElementById("task").innerText = GAME_CONFIG.taskText;

const CELL = 20;
const COLS = canvas.width / CELL;
const ROWS = canvas.height / CELL;

let snake = [{ x: 5, y: 5 }];
let snakeLength = 1;

let direction = "RIGHT";
let nextDirection = "RIGHT";

let items = [];
let correctCollected = 0;

/* =====================
   –£–ü–†–ê–í–õ–ï–ù–ò–ï
===================== */

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp" && direction !== "DOWN") nextDirection = "UP";
  if (e.key === "ArrowDown" && direction !== "UP") nextDirection = "DOWN";
  if (e.key === "ArrowLeft" && direction !== "RIGHT") nextDirection = "LEFT";
  if (e.key === "ArrowRight" && direction !== "LEFT") nextDirection = "RIGHT";
});

/* =====================
   –°–ü–ê–í–ù –≠–õ–ï–ú–ï–ù–¢–û–í
===================== */

function spawnItems() {
  items = [];
  const all = [
    ...GAME_CONFIG.correctItems.map(t => ({ text: t, correct: true })),
    ...GAME_CONFIG.wrongItems.map(t => ({ text: t, correct: false }))
  ];

  while (items.length < GAME_CONFIG.gameplay.elementsOnField) {
    const item = all[Math.floor(Math.random() * all.length)];
    const pos = {
      x: Math.floor(Math.random() * COLS),
      y: Math.floor(Math.random() * ROWS)
    };

    if (!items.some(i => i.x === pos.x && i.y === pos.y)) {
      items.push({ ...item, ...pos });
    }
  }
}

/* =====================
   –î–í–ò–ñ–ï–ù–ò–ï –ó–ú–ï–ô–ö–ò
===================== */

function moveSnake() {
  direction = nextDirection;
  const head = { ...snake[0] };

  if (direction === "UP") head.y--;
  if (direction === "DOWN") head.y++;
  if (direction === "LEFT") head.x--;
  if (direction === "RIGHT") head.x++;

  // –º—è–≥–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã
  if (head.x < 0) head.x = COLS - 1;
  if (head.y < 0) head.y = ROWS - 1;
  if (head.x >= COLS) head.x = 0;
  if (head.y >= ROWS) head.y = 0;

  snake.unshift(head);
  while (snake.length > snakeLength) snake.pop();
}

/* =====================
   –°–ë–û–† –≠–õ–ï–ú–ï–ù–¢–û–í
===================== */

function checkCollision() {
  const head = snake[0];

  items.forEach((item, index) => {
    if (head.x === item.x && head.y === item.y) {

      if (item.correct) {
        snakeLength++;
        correctCollected++;
        showFeedback(true);
      } else {
        showFeedback(false);
      }

      items.splice(index, 1);
    }
  });
}

/* =====================
   –ü–†–û–ì–†–ï–°–°
===================== */

function updateProgress() {
  const percent =
    (correctCollected / GAME_CONFIG.progress.requiredCorrect) * 100;

  document.getElementById("progress-bar").style.width = percent + "%";

  if (percent >= 100) {
    alert("üéâ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!");
    resetGame();
  }
}

/* =====================
   –§–ò–î–ë–ï–ö
===================== */

function showFeedback(success) {
  const box = document.getElementById("feedback");
  const texts = success
    ? GAME_CONFIG.feedback.successText
    : GAME_CONFIG.feedback.errorText;

  box.innerText = texts[Math.floor(Math.random() * texts.length)];
  box.className = success ? "success" : "error";

  setTimeout(() => box.innerText = "", 800);
}

/* =====================
   –û–¢–†–ò–°–û–í–ö–ê
===================== */

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // —ç–ª–µ–º–µ–Ω—Ç—ã
  items.forEach(item => {
    ctx.fillStyle = item.correct ? "#81c784" : "#bdbdbd";
    ctx.fillRect(item.x * CELL, item.y * CELL, CELL - 2, CELL - 2);

    if (!GAME_CONFIG.ui.noTextMode) {
      ctx.fillStyle = "#000";
      ctx.font = "12px Arial";
      ctx.fillText(item.text, item.x * CELL, item.y * CELL - 2);
    }
  });

  // –∑–º–µ–π–∫–∞
  ctx.fillStyle = "#4caf50";
  snake.forEach(seg => {
    ctx.fillRect(seg.x * CELL, seg.y * CELL, CELL - 2, CELL - 2);
  });
}

/* =====================
   –¶–ò–ö–õ –ò–ì–†–´
===================== */

function gameLoop() {
  moveSnake();
  checkCollision();
  updateProgress();
  draw();
}

/* =====================
   –°–ë–†–û–°
===================== */

function resetGame() {
  snake = [{ x: 5, y: 5 }];
  snakeLength = 1;
  correctCollected = 0;
  spawnItems();
}

/* =====================
   –°–¢–ê–†–¢
===================== */

spawnItems();
setInterval(gameLoop, GAME_CONFIG.gameplay.speed);
</script>

</body>
</html>
