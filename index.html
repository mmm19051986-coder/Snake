<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Змейка знаний</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#e3f2fd;
}

#game-wrapper {
  width: 720px;
  margin: 20px auto;
  background:#ffffff;
  padding:12px;
  border-radius:14px;
}

h2 { text-align:center; margin:6px 0; }

#editor {
  border:1px solid #cfd8dc;
  padding:10px;
  margin-bottom:10px;
  background:#f9fbfd;
}

label { font-weight:bold; display:block; margin-top:6px; }

textarea, input {
  width:100%;
  margin-top:4px;
}

button {
  margin-top:8px;
  padding:6px 14px;
  cursor:pointer;
}

canvas {
  display:block;
  margin:auto;
  border-radius:10px;
  background:#f1f8ff;
}

#progress {
  height:10px;
  background:#cfd8dc;
  margin-top:8px;
  border-radius:5px;
}
#progress-bar {
  height:100%;
  width:0%;
  background:#66bb6a;
}

#feedback {
  text-align:center;
  font-weight:bold;
  min-height:22px;
}
.success { color:#2e7d32; }
.error { color:#ef6c00; }
</style>
</head>

<body>

<div id="game-wrapper">
  <h2 id="taskTitle">Собери только глаголы</h2>

  <div id="editor">
    <label>Вопрос / задание</label>
    <input id="taskInput" value="Собери только глаголы">

    <label>Правильные слова</label>
    <textarea id="correctInput">бегать, прыгать, играть</textarea>

    <label>Неправильные слова</label>
    <textarea id="wrongInput">молоко, красивый, важный</textarea>

    <button id="startBtn">▶ Играть</button>
  </div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>

  <div id="progress"><div id="progress-bar"></div></div>
  <div id="feedback"></div>
</div>

<script>
/* ===== ПАРАМЕТРЫ ===== */
const SPEED = 1.2;
const TURN_SPEED = 0.08;
const SEGMENT_STEP = 10;
const REQUIRED = 5;

/* ===== ПЕРЕМЕННЫЕ ===== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let snakePath = [];
let maxLength = 30;
let angle = 0;
let targetAngle = 0;

let items = [];
let correctCount = 0;
let gameRunning = false;
let glowTimer = 0;
let CONFIG = null;

/* ===== КЛИК = НАПРАВЛЕНИЕ ===== */
canvas.addEventListener("click", e => {
  if (!gameRunning) return;
  const r = canvas.getBoundingClientRect();
  const x = e.clientX - r.left;
  const y = e.clientY - r.top;
  const head = snakePath[0];
  targetAngle = Math.atan2(y - head.y, x - head.x);
});

/* ===== СТАРТ ===== */
document.getElementById("startBtn").onclick = () => {
  CONFIG = {
    task: taskInput.value,
    correct: correctInput.value.split(",").map(s=>s.trim()),
    wrong: wrongInput.value.split(",").map(s=>s.trim())
  };
  taskTitle.innerText = CONFIG.task;
  resetGame();
  gameRunning = true;
};

/* ===== ЭЛЕМЕНТЫ ===== */
function spawnItem(forceCorrect=false) {
  const pool = forceCorrect
    ? CONFIG.correct.map(t=>({text:t, correct:true}))
    : [
        ...CONFIG.correct.map(t=>({text:t, correct:true})),
        ...CONFIG.wrong.map(t=>({text:t, correct:false}))
      ];

  const it = pool[Math.floor(Math.random()*pool.length)];
  items.push({
    ...it,
    x:Math.random()*540+30,
    y:Math.random()*340+30
  });
}

function ensureItems() {
  const hasCorrect = items.some(i=>i.correct);
  if (!hasCorrect) spawnItem(true);
  while (items.length < 4) spawnItem();
}

/* ===== ДВИЖЕНИЕ ===== */
function moveSnake() {
  angle += (targetAngle - angle) * TURN_SPEED;
  const head = snakePath[0];

  const newHead = {
    x: head.x + Math.cos(angle) * SPEED,
    y: head.y + Math.sin(angle) * SPEED
  };

  snakePath.unshift(newHead);
  while (snakePath.length > maxLength) snakePath.pop();
}

/* ===== СБОР ===== */
function checkItems() {
  const head = snakePath[0];
  items.forEach((it,i)=>{
    const dx=head.x-it.x;
    const dy=head.y-it.y;
    if (Math.sqrt(dx*dx+dy*dy)<16) {
      if (it.correct) {
        correctCount++;
        maxLength += SEGMENT_STEP;
        glowTimer = 15;
        showFeedback(true);
      } else showFeedback(false);
      items.splice(i,1);
    }
  });
}

/* ===== ПРОГРЕСС ===== */
function updateProgress() {
  const p=Math.min(correctCount/REQUIRED*100,100);
  progressBar.style.width=p+"%";
  if (p>=100) {
    gameRunning=false;
    showStar();
  }
}

/* ===== ОТРИСОВКА ===== */
function draw() {
  ctx.clearRect(0,0,600,400);

  // элементы
  items.forEach(it=>{
    ctx.fillStyle=it.correct?"#81c784":"#b0bec5";
    ctx.beginPath();
    ctx.arc(it.x,it.y,10,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="#000";
    ctx.fillText(it.text,it.x-10,it.y-14);
  });

  // змейка
  ctx.lineWidth=8;
  ctx.strokeStyle=glowTimer>0?"#aed581":"#66bb6a";
  ctx.beginPath();
  snakePath.forEach((p,i)=>{
    if(i===0) ctx.moveTo(p.x,p.y);
    else ctx.lineTo(p.x,p.y);
  });
  ctx.stroke();

  // голова + глазки
  const h=snakePath[0];
  ctx.fillStyle="#388e3c";
  ctx.beginPath();
  ctx.arc(h.x,h.y,7,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(h.x+3,h.y-2,1.5,0,Math.PI*2);
  ctx.arc(h.x+3,h.y+2,1.5,0,Math.PI*2);
  ctx.fill();

  if(glowTimer>0) glowTimer--;
}

/* ===== ЗВЕЗДА ===== */
function showStar() {
  ctx.fillStyle="#ffd54f";
  ctx.font="40px Arial";
  ctx.fillText("⭐ Молодец!",180,200);
}

/* ===== ФИДБЕК ===== */
function showFeedback(ok) {
  feedback.innerText=ok?"Верно!":"Подумай ещё";
  feedback.className=ok?"success":"error";
  setTimeout(()=>feedback.innerText="",600);
}

/* ===== ЦИКЛ ===== */
function loop() {
  if (gameRunning) {
    moveSnake();
    checkItems();
    ensureItems();
    updateProgress();
  }
  draw();
  requestAnimationFrame(loop);
}

/* ===== СБРОС ===== */
function resetGame() {
  snakePath=[{x:300,y:200}];
  angle=0; targetAngle=0;
  items=[]; correctCount=0;
  maxLength=30;
  progressBar.style.width="0%";
  ensureItems();
}

loop();
</script>

</body>
</html>
