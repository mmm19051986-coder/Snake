<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ó–º–µ–π–∫–∞ –∑–Ω–∞–Ω–∏–π</title>

<style>
  body { font-family: Arial, sans-serif; background:#f2f2f2; }

  #game-wrapper {
    width: 640px;
    margin: 20px auto;
    background: #fff;
    padding: 12px;
    border-radius: 12px;
  }

  #task { text-align:center; font-size:20px; margin-bottom:6px; }

  #controls { text-align:center; margin-bottom:6px; }

  button { padding:6px 14px; cursor:pointer; }

  canvas {
    display:block;
    margin:auto;
    border:2px solid #ddd;
    background:#fff;
  }

  #progress { height:10px; background:#ddd; border-radius:5px; margin-top:8px; }
  #progress-bar { height:100%; width:0%; background:#4caf50; }

  #feedback { text-align:center; margin-top:6px; font-weight:bold; min-height:20px; }
  .success { color:green; }
  .error { color:orange; }
</style>
</head>

<body>

<div id="game-wrapper">
  <div id="task">–°–æ–±–µ—Ä–∏ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ</div>

  <div id="controls">
    <button id="startBtn">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
  </div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>

  <div id="progress"><div id="progress-bar"></div></div>
  <div id="feedback"></div>
</div>

<script>
/* =====================
   –ù–ê–°–¢–†–û–ô–ö–ò
===================== */

const CONFIG = {
  correct: ["—Å—Ç–æ–ª","–¥–æ–º","–æ–∫–Ω–æ","–∫–Ω–∏–≥–∞"],
  wrong: ["–±–µ–∂–∞—Ç—å","–∫—Ä–∞—Å–∏–≤—ã–π"],
  required: 6,
  speed: 2,
  minItemsOnField: 4
};

/* =====================
   –ü–ï–†–ï–ú–ï–ù–ù–´–ï
===================== */

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let snake = [{ x: 50, y: 50 }];
let target = null;
let items = [];
let correctCount = 0;
let gameRunning = false;

/* =====================
   –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–ò–ö–û–ú
===================== */

canvas.addEventListener("click", e => {
  if (!gameRunning) return;
  const rect = canvas.getBoundingClientRect();
  target = {
    x: e.clientX - rect.left,
    y: e.clientY - rect.top
  };
});

/* =====================
   –°–¢–ê–†–¢
===================== */

document.getElementById("startBtn").onclick = () => {
  resetGame();
  gameRunning = true;
};

/* =====================
   –≠–õ–ï–ú–ï–ù–¢–´
===================== */

function spawnItem() {
  const all = [
    ...CONFIG.correct.map(t => ({ text:t, correct:true })),
    ...CONFIG.wrong.map(t => ({ text:t, correct:false }))
  ];
  const item = all[Math.floor(Math.random()*all.length)];
  items.push({
    ...item,
    x: Math.random()*560+20,
    y: Math.random()*360+20
  });
}

function ensureItems() {
  while (items.length < CONFIG.minItemsOnField) {
    spawnItem();
  }
}

/* =====================
   –î–í–ò–ñ–ï–ù–ò–ï + –•–í–û–°–¢
===================== */

function moveSnake() {
  if (!target) return;

  const head = snake[0];
  const dx = target.x - head.x;
  const dy = target.y - head.y;
  const dist = Math.sqrt(dx*dx + dy*dy);

  if (dist < 2) return;

  const newHead = {
    x: head.x + (dx/dist)*CONFIG.speed,
    y: head.y + (dy/dist)*CONFIG.speed
  };

  snake.unshift(newHead);
  while (snake.length > correctCount + 1) snake.pop();
}

/* =====================
   –°–ë–û–†
===================== */

function checkCollision() {
  const head = snake[0];

  items.forEach((item, index) => {
    const dx = head.x - item.x;
    const dy = head.y - item.y;

    if (Math.sqrt(dx*dx + dy*dy) < 14) {
      if (item.correct) {
        correctCount++;
        showFeedback(true);
      } else {
        showFeedback(false);
      }
      items.splice(index,1);
    }
  });
}

/* =====================
   –ü–†–û–ì–†–ï–°–°
===================== */

function updateProgress() {
  const percent = Math.min(
    (correctCount / CONFIG.required) * 100,
    100
  );
  document.getElementById("progress-bar").style.width = percent+"%";

  if (percent >= 100) {
    alert("üéâ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!");
    gameRunning = false;
  }
}

/* =====================
   –§–ò–î–ë–ï–ö
===================== */

function showFeedback(success) {
  const box = document.getElementById("feedback");
  box.innerText = success ? "–í–µ—Ä–Ω–æ!" : "–ü–æ–¥—É–º–∞–π –µ—â—ë";
  box.className = success ? "success" : "error";
  setTimeout(()=>box.innerText="",700);
}

/* =====================
   –û–¢–†–ò–°–û–í–ö–ê
===================== */

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // —ç–ª–µ–º–µ–Ω—Ç—ã
  items.forEach(item=>{
    ctx.fillStyle = item.correct ? "#66bb6a" : "#bdbdbd";
    ctx.fillRect(item.x-8,item.y-8,16,16);
    ctx.fillStyle="#000";
    ctx.fillText(item.text,item.x-10,item.y-12);
  });

  // —Ö–≤–æ—Å—Ç
  snake.forEach((seg,i)=>{
    ctx.fillStyle = i===0 ? "#2e7d32" : "#81c784";
    ctx.fillRect(seg.x-8,seg.y-8,16,16);
  });
}

/* =====================
   –¶–ò–ö–õ
===================== */

function loop() {
  if (gameRunning) {
    moveSnake();
    checkCollision();
    ensureItems();
    updateProgress();
  }
  draw();
  requestAnimationFrame(loop);
}

/* =====================
   –°–ë–†–û–°
===================== */

function resetGame() {
  snake = [{ x:50, y:50 }];
  items = [];
  correctCount = 0;
  target = null;
  document.getElementById("progress-bar").style.width="0%";
  ensureItems();
}

/* =====================
   –°–¢–ê–†–¢
===================== */

loop();
</script>

</body>
</html>
